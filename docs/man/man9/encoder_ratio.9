'\" t
.\"     Title: encoder_ratio
.\"    Author: [FIXME: author] [see http://www.docbook.org/tdg5/en/html/author]
.\" Generator: DocBook XSL Stylesheets vsnapshot <http://docbook.sf.net/>
.\"      Date: 05/27/2025
.\"    Manual: LinuxCNC Documentation
.\"    Source: LinuxCNC
.\"  Language: English
.\"
.TH "ENCODER_RATIO" "9" "05/27/2025" "LinuxCNC" "LinuxCNC Documentation"
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
encoder_ratio \- an electronic gear to synchronize two axes
.SH "SYNOPSIS"
.sp
\fBloadrt encoder_ratio\fR [ \fBnum_chan=\fR\fInum\fR | \fBnames=\fR\fIname1\fR[,\fIname2\fR\&...] ]
.SH "DESCRIPTION"
.sp
\fBencoder_ratio\fR can be used to synchronize two axes (like an "electronic gear")\&. It counts encoder pulses from both axes in software, and produces an error value that can be used with a PID loop to make the slave encoder track the master encoder with a specific ratio\&.
.sp
This module supports up to eight axis pairs\&. The number of pairs is set by the module parameter \fBnum_chan\fR\&. Alternatively, specify \fBnames=\fR and unique names separated by commas\&.
.sp
The \fBnum_chan=\fR and \fBnames=\fR specifiers are mutually exclusive\&. If neither \fBnum_chan=\fR nor \fBnames=\fR are specified, the default value is one\&.
.SH "FUNCTIONS"
.PP
\fBencoder\-ratio\&.sample\fR
.RS 4
Read all input pins\&. Must be called at twice the maximum desired count rate\&.
.RE
.PP
\fBencoder\-ratio\&.update (uses floating\-point)\fR
.RS 4
Updates all output pins\&. May be called from a slower thread\&.
.RE
.SH "NAMING"
.sp
The names for pins and parameters are prefixed as: \fBencoder\-ratio\&.N\&.\fR for \fIN\fR=0,1,\&...,\fInum\fR\-1 when using \fBnum_chan=\fR\fInum\fR \fBnameN\&.\fR for \fBnameN=\fR\fIname1\fR,\fIname2\fR,\&... when using \fB*names=\fR\fIname1\fR,\fIname2\fR,\&... \&.
.sp
The \fBencoder\-ratio\&.N\&.\fR format is shown in the following descriptions\&.
.SH "PINS"
.PP
\fBencoder\-ratio\&.\fR\fIN\fR\fB\&.master\-A\fR bit in
.RS 4
.RE
.PP
\fBencoder\-ratio\&.\fR\fIN\fR\fB\&.master\-B\fR bit in
.RS 4
.RE
.PP
\fBencoder\-ratio\&.\fR\fIN\fR\fB\&.slave\-A\fR bit in
.RS 4
.RE
.PP
\fBencoder\-ratio\&.\fR\fIN\fR\fB\&.slave\-B\fR bit in
.RS 4
The encoder channels of the master and slave axes\&.
.RE
.PP
\fBencoder\-ratio\&.\fR\fIN\fR\fB\&.enable\fR bit in
.RS 4
When the enable pin is FALSE, the error pin simply reports the slave axis position, in revolutions\&. As such, it would normally be connected to the feedback pin of a PID block for closed loop control of the slave axis\&. Normally the command input of the PID block is left unconnected (zero), so the slave axis simply sits still\&. However when the enable input goes TRUE, the error pin becomes the slave position minus the scaled master position\&. The scale factor is the ratio of master teeth to slave teeth\&. As the master moves, error becomes non\-zero, and the PID loop will drive the slave axis to track the master\&.
.RE
.PP
\fBencoder\-ratio\&.\fR\fIN\fR\fB\&.error\fR float out
.RS 4
The error in the position of the slave (in revolutions)\&.
.RE
.SH "PARAMETERS"
.PP
\fBencoder\-ratio\&.\fR\fIN\fR\fB\&.master\-ppr\fR unsigned rw, \fBencoder\-ratio\&.\fR\fIN\fR\fB\&.slave\-ppr\fR unsigned rw
.RS 4
The number of pulses per revolution of the master and slave axes\&.
.RE
.PP
\fBencoder\-ratio\&.\fR\fIN\fR\fB\&.master\-teeth\fR unsigned rw, \fBencoder\-ratio\&.\fR\fIN\fR\fB\&.slave\-teeth\fR unsigned rw
.RS 4
The number of "teeth" on the master and slave gears\&.
.RE
.SH "SEE ALSO"
.sp
encoder(9)
