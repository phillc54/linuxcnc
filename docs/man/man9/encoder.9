'\" t
.\"     Title: encoder
.\"    Author: [FIXME: author] [see http://www.docbook.org/tdg5/en/html/author]
.\" Generator: DocBook XSL Stylesheets vsnapshot <http://docbook.sf.net/>
.\"      Date: 05/27/2025
.\"    Manual: LinuxCNC Documentation
.\"    Source: LinuxCNC
.\"  Language: English
.\"
.TH "ENCODER" "9" "05/27/2025" "LinuxCNC" "LinuxCNC Documentation"
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
encoder \- software counting of quadrature encoder signals
.SH "SYNOPSIS"
.sp
\fBloadrt encoder\fR [ \fBnum_chan=\fR\fInum\fR | \fBnames=\fR\fIname1\fR[,\fIname2\fR\&...] ]
.SH "DESCRIPTION"
.sp
\fBencoder\fR is used to measure position by counting the pulses generated by a quadrature encoder\&. As a software\-based implementation it is much less expensive than hardware, but has a limited maximum count rate\&. The limit is in the range of 10 kHz to 50 kHz, depending on the computer speed and other factors\&. If better performance is needed, a hardware encoder counter is a better choice\&. Some hardware\-based systems can count at MHz rates\&.
.sp
\fBencoder\fR supports a maximum of eight channels\&. The number of channels actually loaded is set by the \fBnum_chan\fR argument when the module is loaded\&. Alternatively, specify names= and unique names separated by commas\&.
.sp
The \fBnum_chan=\fR and \fBnames=\fR specifiers are mutually exclusive\&. If neither \fBnum_chan=\fR nor \fBnames=\fR are specified, or if \fBnum_chan=0\fR is specified, the default value is three\&.
.sp
\fBencoder\fR has a one\-phase, unidirectional mode called \fIcounter\fR\&. In this mode, the \fBphase\-B\fR input is ignored; the counts increase on each rising edge of \fBphase\-A\fR\&. This mode may be useful for counting a unidirectional spindle with a single input line, though the noise\-resistant characteristics of quadrature are lost\&.
.sp
If used in counter\-mode it is also possible to enable the missing\-teeth index mode, where a gap in the pulse train of one or more teeth is used as in index marker\&. This system is used extensively for automotive crank position sensors\&.
.SH "FUNCTIONS"
.PP
\fBencoder\&.update\-counters\fR (no floating\-point)
.RS 4
Does the actual counting, by sampling the encoder signals and decoding the quadrature waveforms\&. Must be called as frequently as possible, preferably twice as fast as the maximum desired count rate\&. Operates on all channels at once\&.
.RE
.PP
\fBencoder\&.capture\-position\fR (uses floating point)
.RS 4
Captures the raw counts from
\fBupdate\-counters\fR
and performs scaling and other necessary conversion, handles counter rollover, etc\&. Can (and should) be called less frequently than
\fBupdate\-counters\fR\&. Operates on all channels at once\&.
.RE
.SH "NAMING"
.sp
The names for pins and parameters are prefixed as: \fBencoder\&.N\&.\fR for N=0,1,\&...,num\-1 when using \fBnum_chan=num\fR \fBnameN\&.\fR for nameN=name1,name2,\&... when using \fBnames=name1,name2,\&...\fR
.sp
The \fBencoder\&.N\&.\fR format is shown in the following descriptions\&.
.SH "PINS"
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.counter\-mode\fR bit i/o
.RS 4
Enables counter mode\&. When true, the counter counts each rising edge of the phase\-A input, ignoring the value on phase\-B\&. This is useful for counting the output of a single channel (non\-quadrature) sensor\&. When false (the default), it counts in quadrature mode\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.counts\fR s32 out
.RS 4
Position in encoder counts\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.index\-enable\fR bit i/o
.RS 4
When true,
\fBcounts\fR
and
\fBposition\fR
are reset to zero on the next rising edge of
\fBPhase\-Z\fR\&. At the same time,
\fBindex\-enable\fR
is reset to zero to indicate that the rising edge has occurred\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.min\-speed\-estimate\fR float in (default: 1\&.0)
.RS 4
Determine the minimum speed at which
\fBvelocity\fR
will be estimated as nonzero and
\fBpostition\-interpolated\fR
will be interpolated\&. The units of
\fBmin\-speed\-estimate\fR
are the same as the units of
\fBvelocity\fR\&. Setting this parameter too low will cause it to take a long time for
\fBvelocity\fR* to go to 0 after encoder pulses have stopped arriving\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.phase\-A\fR bit in
.RS 4
Quadrature input for encoder channel
\fIN\fR\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.phase\-B\fR bit in
.RS 4
Quadrature input\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.phase\-Z\fR bit in
.RS 4
Index pulse input\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.position\fR float out
.RS 4
Position in scaled units (see
\fBposition\-scale\fR)
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.position\-interpolated\fR float out
.RS 4
Position in scaled units, interpolated between encoder counts\&. Only valid when velocity is approximately constant and above
\fBmin\-speed\-estimate\fR\&. Do not use for position control\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.position\-scale\fR float i/o
.RS 4
Scale factor, in counts per length unit\&. For example, if
\fBposition\-scale\fR
is 500, then 1000 counts of the encoder will be reported as a position of 2\&.0 units\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.missing\-teeth\fR s32 in
.RS 4
The number of teeth missing from the index gap\&. For example a 60 tooth gear with two teeth shortened to form an index so that there are 58 pulses per revolution would use a position\-scale of 60 and a missing\-teeth of 2\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.rawcounts\fR s32 out
.RS 4
The raw count, as determined by
\fBupdate\-counters\fR\&. This value is updated more frequently than
\fBcounts\fR* and
\fBposition\fR\&. It is also unaffected by
\fBreset\fR
or the index pulse\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.reset\fR bit in
.RS 4
When true,
\fBcounts\fR
and
\fBposition\fR
are reset to zero immediately\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.velocity\fR float out
.RS 4
Velocity in scaled units per second\&.
\fBencoder\fR
uses an algorithm that greatly reduces quantization noise as compared to simply differentiating the
\fBposition\fR
output\&. When the magnitude of the true velocity is below min\-speed\-estimate, the velocity output is 0\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.velocity\-rpm\fR float out
.RS 4
Velocity in scaled units per minute\&. Simply
\fBencoder\&.\fR\fB\fB\fIN\fR\fR\fR\fB\&.velocity\fR
scaled by a factor of 60 for convenience\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.x4\-mode\fR bit i/o
.RS 4
Enables times\-4 mode\&. When true (the default), the counter counts each edge of the quadrature waveform (four counts per full cycle)\&. When false, it only counts once per full cycle\&. In
\fBcounter\-mode\fR, this parameter is ignored\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.latch\-input\fR bit in
.RS 4
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.latch\-falling\fR bit in (default: \fBTRUE\fR)
.RS 4
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.latch\-rising\fR bit in (default: \fBTRUE\fR)
.RS 4
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.counts\-latched\fR s32 out
.RS 4
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.position\-latched\fR float out
.RS 4
Update
\fBcounts\-latched\fR* and
\fBposition\-latched\fR
on the rising and/or falling edges of
\fBlatch\-input\fR
as indicated by
\fBlatch\-rising\fR
and
\fBlatch\-falling\fR\&.
.RE
.PP
\fBencoder\&.\fR\fIN\fR\fB\&.counter\-mode\fR bit rw
.RS 4
Enables counter mode\&. When true, the counter counts each rising edge of the phase\-A input, ignoring the value on phase\-B\&. This is useful for counting the output of a single channel (non\-quadrature) sensor\&. When false (the default), it counts in quadrature mode\&.
\fBencoder\&.\fR\fB\fB\fIN\fR\fR\fR\fB\&.capture\-position\&.tmax\fR* s32 rw Maximum number of CPU cycles it took to execute this function\&.
.RE
.SH "PARAMETERS"
.sp
The encoder component has no HAL Parameters\&.
