'\" t
.\"     Title: mitsub_vfd
.\"    Author: [FIXME: author] [see http://www.docbook.org/tdg5/en/html/author]
.\" Generator: DocBook XSL Stylesheets vsnapshot <http://docbook.sf.net/>
.\"      Date: 05/27/2025
.\"    Manual: LinuxCNC Documentation
.\"    Source: LinuxCNC
.\"  Language: English
.\"
.TH "MITSUB_VFD" "1" "05/27/2025" "LinuxCNC" "LinuxCNC Documentation"
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
mitsub_vfd \- HAL non\-realtime component for Mitsubishi A500 F500 E500 A500 D700 E700 F700\-series VFDs (others may work) This uses the COMPUTER LINK protocol _not_ MODBUS\&. The connection is made through the PU connector\&.
.SH "SYNOPSIS"
.sp
\fBloadrt mitsub_vfd\fR [\fB\-\-baud\fR \fIbaudrate\fR] [\fB\-\-port\fR \fIdevicename\fR] \fBname1=\fR\fInumber\fR\fI1\fR[,\fBname2=\fR\fInumber\fR\fI2\fR\&...]
.PP
\fBname1\fR
.RS 4
is user selectable (usually a description of the controlled device)\&.
.RE
.PP
\fInumber1\fR
.RS 4
is the slave number that was set on the VFD\&. Must be two digits (Parameter 117)\&.
.RE
.PP
name\fIN\fR=number\fIN\fR
.RS 4
can be repeated for multiple VFD\(cqs connected together\&.
.RE
.PP
\fB\-\-baud\fR \fIbaudrate\fR
.RS 4
is optional as it defaults to 9600, all networked vfds must be set to the same baudrate\&.
.RE
.PP
\fB\-\-port\fR \fIdevicename\fR
.RS 4
is optional as it defaults to
ttyS0`, a common alternative is
/dev/ttyUSB0\&.
.RE
.SH "DESCRIPTION"
.sp
The mitsub_vfd component interfaces a Mitsubishi VFD to LinuxCNC\&. The VFD is connected via RS\-485 serial to the computer\(cqs USB or serial port using a RS\-232/RS\-485 converter\&.
.SH "HARDWARE SETUP"
.sp
reference manual \fIcommunication option reference manual\fR and A500 technical manual for 500 series\&. Fr\-A700 F700 E700 D700 technical manual for the 700 series\&. The inverter must be set manually for communication (you may have to set PR 77 to 1 to unlock PR modification)\&. You must power cycle the inverter for some of these, e\&.g\&. 79\&.
.sp
\fBVFD INTERNAL PARAMETERS\fR:
.PP
\fBPARAMETER 79\fR
.RS 4
1 or 0
.RE
.PP
\fBPARAMETER 117\fR
.RS 4
Station number \- 1

(can be optionally set 0 \- 31) if component is also set
.RE
.PP
\fBPARAMETER 118\fR
.RS 4
Communication speed 96

(can be optionally set 48, 96, 192 if component is also set)
.RE
.PP
\fBPARAMETER 119\fR
.RS 4
Stop bit/data length \- 1

(8 bits, two stop \- don\(cqt change)
.RE
.PP
\fBPARAMETER 120\fR
.RS 4
Parity \- 0

(no parity \- don\(cqt change)
.RE
.PP
\fBPARAMETER 121\fR
.RS 4
COM tries \- 10

(if maximum 10 COM errors then inverter faults\- can change\&.)
.RE
.PP
\fBPARAMETER 122\fR
.RS 4
COM check time interval 9999

(never check \- if communication is lost inverter will not know (can change))
.RE
.PP
\fBPARAMETER 123\fR
.RS 4
Wait time \- 9999

No wait time is added to the serial data frame (don\(cqt change)\&.
.RE
.PP
\fBPARAMETER 124\fR
.RS 4
CR selection \- 0

Don\(cqt change\&.
.RE
.PP
\fBPARAMETER 549\fR
.RS 4
Communication protocol \- 0

Computer link protocol \- don\(cqt change \- (not all VFDs have this)
.RE
.SH "NOTES"
.sp
This driver assumes certain other VFD settings:
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
That the motor frequency status is set to show Hertz\&.
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
That the status bit 3 is up to speed\&.
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
That the status bit 7 is alarm\&.
.RE
.sp
Some models, e\&.g\&. the E500, cannot monitor status\&. You must set set the monitor pin to false\&. In this case pins such as up\-to\-speed, amps, alarm and status bits are not useful\&.
.SH "PINS"
.PP
\fIVFD_NAME\fR\fB\&.fwd\fR (bit, in)
.RS 4
Forward/reverse pin
.RE
.PP
\fIVFD_NAME\fR\fB\&.run\fR (bit, in)
.RS 4
Run/stop pin
.RE
.PP
\fIVFD_NAME\fR\fB\&.debug\fR (bit, in)
.RS 4
Set debug mode pin\&. This will print many messages to the terminal\&.
.RE
.PP
\fIVFD_NAME\fR\fB\&.monitor\fR (bit, in)
.RS 4
Set monitor mode pin\&. If false, request\-status command will not be sent to VFD\&. Status, amps, power, motor\-feedback, and alarm would then not be useful\&.
.RE
.PP
\fIVFD_NAME\fR\fB\&.estop\fR (bit, in)
.RS 4
Set E\-stop mode pin\&. This will stop the VFD\&. Restarting requires the run pin to cycle\&.
.RE
.PP
\fIVFD_NAME\fR\fB\&.fwd\fR (bit, out)
.RS 4
Up\-to\-speed status pin\&. Motor is at requested speed within VFD\(cqs settings tolerance\&.
.RE
.PP
\fIVFD_NAME\fR\fB\&.alarm\fR (bit, out)
.RS 4
Alarm status pin
.RE
.PP
\fIVFD_NAME\fR\fB\&.motor\-cmd\fR (float, in)
.RS 4
The requested motor speed, in Hertz (Hz)
.RE
.PP
\fIVFD_NAME\fR\fB\&.motor\-fb\fR (float, out)
.RS 4
The motor feedback speed (from VFD) in Hertz (Hz)
.RE
.PP
\fIVFD_NAME\fR\fB\&.motor\-amps\fR (float, out)
.RS 4
The motor current, in amperes (A)
.RE
.PP
\fIVFD_NAME\fR\fB\&.motor\-power\fR (float, out)
.RS 4
The motor power
.RE
.PP
\fIVFD_NAME\fR\fB\&.scale\-cmd\fR (float, in)
.RS 4
Motor command\(cqs scale setting defaults to 1
.RE
.PP
\fIVFD_NAME\fR\fB\&.scale\-cmd\fR (float, in)
.RS 4
Motor command\(cqs scale setting defaults to 1
.RE
.PP
\fIVFD_NAME\fR\fB\&.scale\-cmd\fR (float, in)
.RS 4
Motor command\(cqs scale setting defaults to 1
.RE
.PP
\fIVFD_NAME\fR\fB\&.stat\-bit\-0\fR (bit, out)
.RS 4
Raw status bit
.RE
.PP
\fIVFD_NAME\fR\fB\&.stat\-bit\-1\fR (bit, out)
.RS 4
Raw status bit
.RE
.PP
\fIVFD_NAME\fR\fB\&.stat\-bit\-2\fR (bit, out)
.RS 4
Raw status bit
.RE
.PP
\fIVFD_NAME\fR\fB\&.stat\-bit\-3\fR (bit, out)
.RS 4
Raw status bit\&. Configure the VFD so that the function
\fIUp to frequency\fR
or
\fImotor\-at\-speed\fR
is assigned to status bit 3 (parameter 191 for 700 series)\&.
.RE
.PP
\fIVFD_NAME\fR\fB\&.stat\-bit\-4\fR (bit, out)
.RS 4
Raw status bit
.RE
.PP
\fIVFD_NAME\fR\fB\&.stat\-bit\-5\fR (bit, out)
.RS 4
Raw status bit
.RE
.PP
\fIVFD_NAME\fR\fB\&.stat\-bit\-6\fR (bit, out)
.RS 4
Raw status bit
.RE
.PP
\fIVFD_NAME\fR\fB\&.stat\-bit\-7\fR (bit, out)
.RS 4
Raw status bit\&. Configure the VFD so that the function
\fIalarm\fR
is assigned to status bit 7 (parameter 195 for 700 series)
.RE
.SH "SAMPLE HAL"
.sp
.if n \{\
.RS 4
.\}
.nf
loadusr \-Wn coolant mitsub_vfd \-\-port /dev/ttyUSB0 spindle=02 coolant=01
# **************** Spindle VFD setup slave 2 ****************
net spindle\-vel\-cmd spindle\&.motor\-cmd
net spindle\-cw spindle\&.fwd
net spindle\-on spindle\&.run
net spindle\-at\-speed spindle\&.up\-to\-speed
net estop\-out spindle\&.estop
# cmd scaled to RPM (belt/gearbox driven)
setp spindle\&.scale\-cmd \&.135
# feedback is in rpm (recipicale of command)
setp spindle\&.scale\-fb 7\&.411
# turn on monitoring so feedback works
setp spindle\&.monitor 1
net spindle\-speed\-indicator spindle\&.motor\-fb
# *************** Coolant VFD setup slave 1 *****************
net coolant\-flood coolant\&.run
net coolant\-is\-on coolant\&.up\-to\-speed
# cmd and feedback scaled to hertz
setp coolant\&.scale\-cmd 1
setp coolant\&.scale\-fb 1
# command full speed
setp coolant\&.motor\-cmd 60
# allows us to see status
setp coolant\&.monitor 1
net estop\-out coolant\&.estop
.fi
.if n \{\
.RE
.\}
.SH "ISSUES"
.sp
Some models, e\&.g\&. E500, cannot monitor status, so set the monitor pin to false\&. In this case, pins such as up\-to\-speed, amps, alarm and status bits are not useful\&.
